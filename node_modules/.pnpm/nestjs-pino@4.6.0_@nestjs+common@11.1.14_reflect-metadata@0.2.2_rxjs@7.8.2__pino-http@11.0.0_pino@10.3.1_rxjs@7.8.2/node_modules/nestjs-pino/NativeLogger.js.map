{"version":3,"file":"NativeLogger.js","sourceRoot":"","sources":["../src/NativeLogger.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Injectable, LoggerService, Inject } from '@nestjs/common';\nimport { Level } from 'pino';\n\nimport { Params, PARAMS_PROVIDER_TOKEN } from './params';\nimport { PinoLogger } from './PinoLogger';\n\n@Injectable()\nexport class NativeLogger implements LoggerService {\n  private readonly contextName: string;\n\n  constructor(\n    protected readonly logger: PinoLogger,\n    @Inject(PARAMS_PROVIDER_TOKEN) { renameContext }: Params,\n  ) {\n    this.contextName = renameContext || 'context';\n  }\n\n  verbose(message: any, ...optionalParams: any[]) {\n    this.call('trace', message, ...optionalParams);\n  }\n\n  debug(message: any, ...optionalParams: any[]) {\n    this.call('debug', message, ...optionalParams);\n  }\n\n  log(message: any, ...optionalParams: any[]) {\n    this.call('info', message, ...optionalParams);\n  }\n\n  warn(message: any, ...optionalParams: any[]) {\n    this.call('warn', message, ...optionalParams);\n  }\n\n  error(message: any, ...optionalParams: any[]) {\n    this.callError(message, ...optionalParams);\n  }\n\n  fatal(message: any, ...optionalParams: any[]) {\n    this.call('fatal', message, ...optionalParams);\n  }\n\n  private call(level: Level, message: any, ...optionalParams: any[]) {\n    const args = [message, ...optionalParams];\n    const { messages, context } = this.getContextAndMessagesToPrint(args);\n    for (const msg of messages) {\n      this.logSingleMessage(level, msg, context);\n    }\n  }\n\n  private callError(message: any, ...optionalParams: any[]) {\n    const args = [message, ...optionalParams];\n    const { messages, context, stack } =\n      this.getContextAndStackAndMessagesToPrint(args);\n    for (const msg of messages) {\n      this.logSingleMessage('error', msg, context, stack);\n    }\n  }\n\n  private logSingleMessage(\n    level: Level,\n    message: unknown,\n    context: string | undefined,\n    stack?: string,\n  ) {\n    const objArg: Record<string, any> = {};\n\n    if (context) {\n      objArg[this.contextName] = context;\n    }\n\n    if (stack) {\n      objArg.stack = stack;\n    }\n\n    if (typeof message === 'object' && message !== null) {\n      if (message instanceof Error) {\n        this.logger[level](objArg, message.stack || message.message);\n      } else {\n        this.logger[level](objArg, message as unknown as string);\n      }\n    } else {\n      this.logger[level](objArg, String(message));\n    }\n  }\n\n  private getContextAndMessagesToPrint(args: unknown[]): {\n    messages: unknown[];\n    context: string | undefined;\n  } {\n    if (args.length <= 1) {\n      return { messages: args, context: undefined };\n    }\n    const lastElement = args[args.length - 1];\n    if (typeof lastElement === 'string') {\n      return {\n        context: lastElement,\n        messages: args.slice(0, args.length - 1),\n      };\n    }\n    return { messages: args, context: undefined };\n  }\n\n  private getContextAndStackAndMessagesToPrint(args: unknown[]): {\n    messages: unknown[];\n    context: string | undefined;\n    stack?: string;\n  } {\n    if (args.length === 2) {\n      if (this.isStackFormat(args[1])) {\n        return {\n          messages: [args[0]],\n          stack: args[1] as string,\n          context: undefined,\n        };\n      }\n      if (typeof args[1] === 'string') {\n        return {\n          messages: [args[0]],\n          context: args[1],\n        };\n      }\n    }\n\n    const { messages, context } = this.getContextAndMessagesToPrint(args);\n    if (messages.length <= 1) {\n      return { messages, context };\n    }\n\n    const lastMessage = messages[messages.length - 1];\n    if (typeof lastMessage === 'string' || typeof lastMessage === 'undefined') {\n      return {\n        stack: lastMessage,\n        messages: messages.slice(0, messages.length - 1),\n        context,\n      };\n    }\n    return { messages, context };\n  }\n\n  private isStackFormat(value: unknown): boolean {\n    if (typeof value !== 'string' && typeof value !== 'undefined') {\n      return false;\n    }\n    return typeof value === 'string' && /^(.)+\\n\\s+at .+:\\d+:\\d+/.test(value);\n  }\n}\n"]}